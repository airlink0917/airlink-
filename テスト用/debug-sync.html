<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒæœŸå•é¡Œãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: -apple-system, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #dc3545;
            padding-bottom: 10px;
        }
        .section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background: #0056b3;
        }
        .danger-btn {
            background: #dc3545;
        }
        .danger-btn:hover {
            background: #c82333;
        }
        .success-btn {
            background: #28a745;
        }
        .success-btn:hover {
            background: #218838;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .data-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
        }
        .event-item {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .deleted {
            background: #ffebee;
            border-left-color: #dc3545;
            text-decoration: line-through;
            opacity: 0.7;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .log-entry {
            padding: 5px;
            margin: 2px 0;
            border-radius: 3px;
        }
        .log-error {
            background: #ffebee;
            color: #c62828;
        }
        .log-success {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .log-info {
            background: #e3f2fd;
            color: #1565c0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” åŒæœŸå•é¡Œãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>

    <div class="section">
        <h2>1. æ¥ç¶šçŠ¶æ…‹ã®ç¢ºèª</h2>
        <button onclick="checkConnection()">Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testLocalStorage()">LocalStorageç¢ºèª</button>
        <div id="connectionStatus" class="status info">å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="section">
        <h2>2. ãƒ‡ãƒ¼ã‚¿ã®çŠ¶æ…‹ç¢ºèª</h2>
        <button onclick="compareData()">ãƒ­ãƒ¼ã‚«ãƒ« vs Supabase æ¯”è¼ƒ</button>
        <button onclick="showDeletedItems()">å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º</button>
        <button onclick="showConflicts()">ç«¶åˆãƒ‡ãƒ¼ã‚¿æ¤œå‡º</button>
        <div id="dataComparison" class="data-display"></div>
    </div>

    <div class="section">
        <h2>3. åŒæœŸãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testDelete()">å‰Šé™¤ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="forceSync()">å¼·åˆ¶åŒæœŸ</button>
        <button onclick="monitorSync()">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–é–‹å§‹</button>
        <div id="syncLog" class="data-display"></div>
    </div>

    <div class="section">
        <h2>4. ãƒ‡ãƒ¼ã‚¿ä¿®å¾©</h2>
        <p style="color: red;">âš ï¸ ä»¥ä¸‹ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼</p>
        <button class="danger-btn" onclick="clearLocalOnly()">ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¯ãƒªã‚¢</button>
        <button class="danger-btn" onclick="clearSupabaseOnly()">Supabaseãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚¯ãƒªã‚¢</button>
        <button class="danger-btn" onclick="fullReset()">å®Œå…¨ãƒªã‚»ãƒƒãƒˆ</button>
        <button class="success-btn" onclick="syncFromSupabase()">Supabaseã‹ã‚‰å¾©å…ƒ</button>
        <button class="success-btn" onclick="syncToSupabase()">ãƒ­ãƒ¼ã‚«ãƒ«ã‚’Supabaseã«ä¸Šæ›¸ã</button>
        <div id="repairStatus" class="status info">å¾…æ©Ÿä¸­...</div>
    </div>

    <div class="section">
        <h2>5. è©³ç´°ãƒ­ã‚°</h2>
        <button onclick="clearLogs()">ãƒ­ã‚°ã‚¯ãƒªã‚¢</button>
        <div id="detailLog" class="data-display" style="font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        // Supabaseè¨­å®š
        const SUPABASE_URL = 'https://igjkroqjhwhewtrprhds.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlnamtyb3FqaHdoZXd0cnByaGRzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyNTQ5ODEsImV4cCI6MjA3MzgzMDk4MX0.7pD4mWSbr8FvGKIjkNSrQuLdUPISxayZGANZ27TuqzI';
        const USER_ID = 'global_user';

        let supabase = null;
        let monitoringInterval = null;

        // åˆæœŸåŒ–
        function init() {
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                addLog('Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–æˆåŠŸ', 'success');
            } catch (error) {
                addLog('SupabaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // ãƒ­ã‚°è¿½åŠ 
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('detailLog');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // æ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function checkConnection() {
            const status = document.getElementById('connectionStatus');
            status.className = 'status warning';
            status.textContent = 'æ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...';

            try {
                const { data, error } = await supabase
                    .from('schedule_events')
                    .select('count')
                    .eq('user_id', USER_ID)
                    .single();

                if (error) throw error;

                status.className = 'status success';
                status.textContent = `âœ… Supabaseæ¥ç¶šæˆåŠŸ`;
                addLog('Supabaseæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ${error.message}`;
                addLog('Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // LocalStorageãƒ†ã‚¹ãƒˆ
        function testLocalStorage() {
            const status = document.getElementById('connectionStatus');
            try {
                const events = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');
                const staff = JSON.parse(localStorage.getItem('staffMembers') || '[]');

                status.className = 'status success';
                status.textContent = `âœ… LocalStorageæ­£å¸¸: ã‚¤ãƒ™ãƒ³ãƒˆ${events.length}ä»¶, ã‚¹ã‚¿ãƒƒãƒ•${staff.length}å`;
                addLog(`LocalStorage: ã‚¤ãƒ™ãƒ³ãƒˆ${events.length}ä»¶, ã‚¹ã‚¿ãƒƒãƒ•${staff.length}å`, 'success');
            } catch (error) {
                status.className = 'status error';
                status.textContent = `âŒ LocalStorageã‚¨ãƒ©ãƒ¼: ${error.message}`;
                addLog('LocalStorageã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒ
        async function compareData() {
            const compDiv = document.getElementById('dataComparison');
            compDiv.innerHTML = '<h3>ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒä¸­...</h3>';

            try {
                // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿
                const localEvents = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');

                // Supabaseãƒ‡ãƒ¼ã‚¿
                const { data: supabaseEvents, error } = await supabase
                    .from('schedule_events')
                    .select('*')
                    .eq('user_id', USER_ID);

                if (error) throw error;

                // æ¯”è¼ƒçµæœè¡¨ç¤º
                let html = '<h3>ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒçµæœ</h3>';
                html += `<p><strong>ãƒ­ãƒ¼ã‚«ãƒ«:</strong> ${localEvents.length}ä»¶</p>`;
                html += `<p><strong>Supabase:</strong> ${supabaseEvents.length}ä»¶</p>`;

                // IDã®ã‚»ãƒƒãƒˆä½œæˆ
                const localIds = new Set(localEvents.map(e => String(e.id)));
                const supabaseIds = new Set(supabaseEvents.map(e => String(e.event_id)));

                // ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿
                const localOnly = localEvents.filter(e => !supabaseIds.has(String(e.id)));
                if (localOnly.length > 0) {
                    html += '<h4>ğŸ”µ ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿å­˜åœ¨:</h4>';
                    localOnly.forEach(e => {
                        html += `<div class="event-item">${e.date} - ${e.title || '(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)'} (ID: ${e.id})</div>`;
                    });
                }

                // Supabaseã®ã¿
                const supabaseOnly = supabaseEvents.filter(e => !localIds.has(String(e.event_id)));
                if (supabaseOnly.length > 0) {
                    html += '<h4>ğŸŸ¢ Supabaseã®ã¿å­˜åœ¨:</h4>';
                    supabaseOnly.forEach(e => {
                        html += `<div class="event-item">${e.date} - ${e.title || '(ã‚¿ã‚¤ãƒˆãƒ«ãªã—)'} (ID: ${e.event_id})</div>`;
                    });
                }

                // ä¸¡æ–¹ã«å­˜åœ¨
                const common = localEvents.filter(e => supabaseIds.has(String(e.id)));
                html += `<h4>ğŸ”„ ä¸¡æ–¹ã«å­˜åœ¨: ${common.length}ä»¶</h4>`;

                compDiv.innerHTML = html;
                addLog('ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒå®Œäº†', 'success');

            } catch (error) {
                compDiv.innerHTML = `<p class="error">æ¯”è¼ƒã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                addLog('ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // å‰Šé™¤ãƒ†ã‚¹ãƒˆ
        async function testDelete() {
            const logDiv = document.getElementById('syncLog');
            logDiv.innerHTML = '<h3>å‰Šé™¤ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</h3>';

            try {
                // ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
                const testEvent = {
                    id: 'test_' + Date.now(),
                    date: new Date().toISOString().split('T')[0],
                    title: 'å‰Šé™¤ãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ™ãƒ³ãƒˆ',
                    person: 'staff-0',
                    color: '#FF0000'
                };

                // ãƒ­ãƒ¼ã‚«ãƒ«ã«è¿½åŠ 
                const events = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');
                events.push(testEvent);
                localStorage.setItem('scheduleEvents', JSON.stringify(events));
                logDiv.innerHTML += '<p>âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã«è¿½åŠ </p>';

                // Supabaseã«è¿½åŠ 
                const { error: insertError } = await supabase
                    .from('schedule_events')
                    .insert({
                        user_id: USER_ID,
                        event_id: testEvent.id,
                        title: testEvent.title,
                        date: testEvent.date,
                        person: testEvent.person,
                        color: testEvent.color
                    });

                if (insertError) throw insertError;
                logDiv.innerHTML += '<p>âœ… Supabaseã«è¿½åŠ </p>';

                // 3ç§’å¾…æ©Ÿ
                await new Promise(resolve => setTimeout(resolve, 3000));

                // ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰å‰Šé™¤
                const updatedEvents = events.filter(e => e.id !== testEvent.id);
                localStorage.setItem('scheduleEvents', JSON.stringify(updatedEvents));
                logDiv.innerHTML += '<p>âœ… ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰å‰Šé™¤</p>';

                // Supabaseã‹ã‚‰å‰Šé™¤
                const { error: deleteError } = await supabase
                    .from('schedule_events')
                    .delete()
                    .eq('event_id', testEvent.id)
                    .eq('user_id', USER_ID);

                if (deleteError) throw deleteError;
                logDiv.innerHTML += '<p>âœ… Supabaseã‹ã‚‰å‰Šé™¤</p>';

                // ç¢ºèª
                await new Promise(resolve => setTimeout(resolve, 2000));
                const finalEvents = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');
                const testExists = finalEvents.some(e => e.id === testEvent.id);

                if (testExists) {
                    logDiv.innerHTML += '<p class="error">âŒ å‰Šé™¤å¤±æ•—: ã‚¤ãƒ™ãƒ³ãƒˆãŒæ®‹å­˜</p>';
                    addLog('å‰Šé™¤ãƒ†ã‚¹ãƒˆå¤±æ•—: ã‚¤ãƒ™ãƒ³ãƒˆãŒæ®‹å­˜', 'error');
                } else {
                    logDiv.innerHTML += '<p class="success">âœ… å‰Šé™¤ãƒ†ã‚¹ãƒˆæˆåŠŸ</p>';
                    addLog('å‰Šé™¤ãƒ†ã‚¹ãƒˆæˆåŠŸ', 'success');
                }

            } catch (error) {
                logDiv.innerHTML += `<p class="error">âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                addLog('å‰Šé™¤ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // å¼·åˆ¶åŒæœŸ
        async function forceSync() {
            const logDiv = document.getElementById('syncLog');
            logDiv.innerHTML = '<h3>å¼·åˆ¶åŒæœŸå®Ÿè¡Œä¸­...</h3>';

            try {
                // Supabaseã‹ã‚‰å–å¾—
                const { data: supabaseEvents, error } = await supabase
                    .from('schedule_events')
                    .select('*')
                    .eq('user_id', USER_ID);

                if (error) throw error;

                // ãƒ­ãƒ¼ã‚«ãƒ«ã‚’å®Œå…¨ã«ç½®ãæ›ãˆ
                const events = supabaseEvents.map(e => ({
                    id: String(e.event_id),
                    date: e.date,
                    person: e.person,
                    title: e.title,
                    time: e.time,
                    color: e.color,
                    note: e.note,
                    isCampaign: e.is_campaign,
                    campaignMembers: e.campaign_members
                }));

                localStorage.setItem('scheduleEvents', JSON.stringify(events));
                logDiv.innerHTML += `<p class="success">âœ… å¼·åˆ¶åŒæœŸå®Œäº†: ${events.length}ä»¶</p>`;
                addLog(`å¼·åˆ¶åŒæœŸå®Œäº†: ${events.length}ä»¶`, 'success');

                // ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å†æç”»
                if (window.opener && window.opener.renderCalendar) {
                    window.opener.renderCalendar();
                    logDiv.innerHTML += '<p class="success">âœ… ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å†æç”»</p>';
                }

            } catch (error) {
                logDiv.innerHTML += `<p class="error">âŒ åŒæœŸã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                addLog('å¼·åˆ¶åŒæœŸã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢ç³»
        async function clearLocalOnly() {
            if (confirm('æœ¬å½“ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                localStorage.removeItem('scheduleEvents');
                localStorage.removeItem('staffMembers');
                document.getElementById('repairStatus').className = 'status success';
                document.getElementById('repairStatus').textContent = 'âœ… ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ';
                addLog('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
            }
        }

        async function clearSupabaseOnly() {
            if (confirm('æœ¬å½“ã«Supabaseãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    const { error } = await supabase
                        .from('schedule_events')
                        .delete()
                        .eq('user_id', USER_ID);

                    if (error) throw error;

                    document.getElementById('repairStatus').className = 'status success';
                    document.getElementById('repairStatus').textContent = 'âœ… Supabaseãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ';
                    addLog('Supabaseãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
                } catch (error) {
                    document.getElementById('repairStatus').className = 'status error';
                    document.getElementById('repairStatus').textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                    addLog('Supabaseã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                }
            }
        }

        async function fullReset() {
            if (confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ï¼')) {
                await clearLocalOnly();
                await clearSupabaseOnly();
                document.getElementById('repairStatus').textContent = 'âœ… å®Œå…¨ãƒªã‚»ãƒƒãƒˆå®Œäº†';
            }
        }

        async function syncFromSupabase() {
            await forceSync();
            document.getElementById('repairStatus').className = 'status success';
            document.getElementById('repairStatus').textContent = 'âœ… Supabaseã‹ã‚‰å¾©å…ƒã—ã¾ã—ãŸ';
        }

        async function syncToSupabase() {
            if (confirm('ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã§Supabaseã‚’ä¸Šæ›¸ãã—ã¾ã™ã‹ï¼Ÿ')) {
                try {
                    // ã¾ãšSupabaseã‚’ã‚¯ãƒªã‚¢
                    await supabase
                        .from('schedule_events')
                        .delete()
                        .eq('user_id', USER_ID);

                    // ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                    const events = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');

                    // Supabaseã«ä¿å­˜
                    for (const event of events) {
                        await supabase
                            .from('schedule_events')
                            .insert({
                                user_id: USER_ID,
                                event_id: event.id,
                                title: event.title,
                                date: event.date,
                                time: event.time,
                                person: event.person,
                                color: event.color,
                                note: event.note,
                                is_campaign: event.isCampaign,
                                campaign_members: event.campaignMembers
                            });
                    }

                    document.getElementById('repairStatus').className = 'status success';
                    document.getElementById('repairStatus').textContent = `âœ… ${events.length}ä»¶ã‚’Supabaseã«ä¿å­˜ã—ã¾ã—ãŸ`;
                    addLog(`Supabaseã«${events.length}ä»¶ä¿å­˜å®Œäº†`, 'success');
                } catch (error) {
                    document.getElementById('repairStatus').className = 'status error';
                    document.getElementById('repairStatus').textContent = `âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                    addLog('Supabaseä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error.message, 'error');
                }
            }
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
        function monitorSync() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                document.getElementById('syncLog').innerHTML += '<p>ç›£è¦–åœæ­¢</p>';
                return;
            }

            document.getElementById('syncLog').innerHTML = '<h3>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ä¸­...</h3>';

            monitoringInterval = setInterval(async () => {
                const localEvents = JSON.parse(localStorage.getItem('scheduleEvents') || '[]');
                const { data: supabaseEvents } = await supabase
                    .from('schedule_events')
                    .select('*')
                    .eq('user_id', USER_ID);

                const status = `Local: ${localEvents.length} | Supabase: ${supabaseEvents?.length || 0} | ${new Date().toLocaleTimeString()}`;
                document.getElementById('syncLog').innerHTML = `<h3>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ä¸­...</h3><p>${status}</p>`;
            }, 2000);
        }

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢
        function clearLogs() {
            document.getElementById('detailLog').innerHTML = '';
        }

        // å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ è¡¨ç¤º
        function showDeletedItems() {
            // å®Ÿè£…ã¯çœç•¥ï¼ˆå±¥æ­´æ©Ÿèƒ½ãŒå¿…è¦ï¼‰
            document.getElementById('dataComparison').innerHTML = '<p>å‰Šé™¤å±¥æ­´æ©Ÿèƒ½ã¯æœªå®Ÿè£…ã§ã™</p>';
        }

        // ç«¶åˆæ¤œå‡º
        function showConflicts() {
            // å®Ÿè£…ã¯çœç•¥ï¼ˆã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—æ¯”è¼ƒãŒå¿…è¦ï¼‰
            document.getElementById('dataComparison').innerHTML = '<p>ç«¶åˆæ¤œå‡ºæ©Ÿèƒ½ã¯æœªå®Ÿè£…ã§ã™</p>';
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>